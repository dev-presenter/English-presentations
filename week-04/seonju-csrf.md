# Cross-site request forgery (CSRF)

## What is CSRF?

- CSRF is an attack that forces authenticated users to submit a request to a web application against which they are currently authenticated.
- CSRF attacks exploit the trust a web application has in an authenticated user.
- CSRF attack exploits a vulnerability in a Web application if it cannot differentiate between a request generated by an individual user and a request generated by a user without their consent.

## How does CSRF work?

### Purpose of CSRF attack

- To force the user to submit **a state-changing request**
- Examples:
    - Submitting or deleting a record
    - Submitting a transaction
    - Purchasing a product
    - Changing a password
    - Sending a message
    - 
### How does CSRF work?
![image](https://github.com/dev-presenter/English-presentations/assets/52817735/7eafb3d2-80ce-42f7-9536-a163c4dea0a9)

*[https://www.okta.com/identity-101/csrf-attack/](https://www.okta.com/identity-101/csrf-attack/)*

To give you an example, let’s say that Bob has an online banking account on [samplebank.com](http://samplebank.com/). He regularly visits this site to conduct transactions with his friend Alice.

1. **Create a request in the form of a URL**

   The online banking application is built using the GET method to submit a transfer request.

   Bob’s request to transfer $500 to Alice (with account number 213367) might look like this:

    ```
    GET https://samplebank.com/onlinebanking/transfer?amount=500&accountNumber=213367 HTTP/1.1
    ```

   Aligning with the first requirement to successfully launch a CSRF attack, an attacker must craft a malicious URL to transfer $5,000 to account 425654:

    ```
    https://samplebank.com/onlinebanking/transfer?amount=5000&accountNumber=425654
    ```

2. **Embed the request into a hyperlink and send it to a visitor**

   Using various social engineering attack methods, an attacker can trick Bob into loading the malicious URL.

   For instance, including malicious HTML image elements onto forms, placing a malicious URL on pages that are often accessed by Bob while logged into the application, or sending a malicious URL through email.

    ```html
    <img src="https://samplebank.com/onlinebanking/transfer?amount=5000&accountNumber=425654" width="0" height= "0">
    ```

3. **Send the request to the site by clicking the link**

   Upon receiving it, Bob’s browser application opens this URL automatically without human intervention. As a result, without Bob’s permission, a malicious request is sent to the online banking application.

4. **Send information to the attacker**

   If Bob has an active session with [samplebank.com](http://samplebank.com/), the application would treat this as an authorized amount transfer request coming from Bob. It would then transfer the amount to the account specified by an attacker.


### Condition for CSRF attack

To carry out a successful CSRF attack, consider the following:

- The attack will only be successful if a user is in an active session with a vulnerable application.
- An attacker must find a valid URL to maliciously craft. The URL needs to have a state-changing effect on the target application.
- An attacker also needs to find the right values for the URL parameters. Otherwise, the target application might reject the malicious request.

## How can prevent a CSRF attack?

- CSRF tokens
    - A CSRF token is a unique, secret, and unpredictable value that is generated by the server-side application and shared with the client. When attempting to perform a sensitive action, such as submitting a form, the client must include the correct CSRF token in the request. This makes it very difficult for an attacker to construct a valid request on behalf of the victim.
- SameSite cookies
    - SameSite is a browser security mechanism that determines when a website's cookies are included in requests originating from other websites. As requests to perform sensitive actions typically require an authenticated session cookie, the appropriate SameSite restrictions may prevent an attacker from triggering these actions cross-site. Since 2021, Chrome enforces `Lax` SameSite restrictions by default. As this is the proposed standard, we expect other major browsers to adopt this behavior in future.
- Referer-based validation
    - Some applications make use of the HTTP Referer header to attempt to defend against CSRF attacks, normally by verifying that the request originated from the application's own domain. This is generally less effective than CSRF token validation.

## References

- [What Is Cross-Site Request Forgery (CSRF) and How Does It Work? | Synopsys](https://www.synopsys.com/glossary/what-is-csrf.html)

- [What is CSRF (Cross-site request forgery)? Tutorial & Examples | Web Security Academy](https://portswigger.net/web-security/csrf)

- [Cross Site Request Forgery (CSRF) | OWASP Foundation](https://owasp.org/www-community/attacks/csrf)

- [CSRF Attack: Cross-Site Request Forgery Definition & Defense | Okta](https://www.okta.com/identity-101/csrf-attack/)
